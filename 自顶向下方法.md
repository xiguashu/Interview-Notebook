# 自顶向下方法

《计算机网络 --自顶向下方法》阅读过程中的整理



## 应用层

#### 套接字（Socket）：进程与计算机网络之间的接口

从一个进程向另一个进程发送的报文必须通过下层的网络，进程通过一个称为套接字的软件接口向网络发送报文和从网络接收报文。进程只负责把报文塞给套接字，且假设该套接字与目的套接字之间有运输的基础设施，该设施会将报文传到目的进程的套接字中。

- 应用程序的要求：可靠数据传输、吞吐量、定时（时延）、安全性
- 安全套接字层（Secure Sockets Layer）是对TCP的加强，这种强化是在应用层上实现的。加密、数据完整性和端点鉴别。



#### HTTP协议

HTTP定义了Web客户向Web服务器请求WEB页面的方式，以及服务器向客户传送WEB页面的方式。

##### 1. 特点

- 基于TCP。建立TCP连接之后往套接字中塞HTTP报文即可。
- 无状态协议。不保存关于客户的任何信息。



##### 2. 非持续连接和持续连接

- 每一个请求建立一个单独的TCP连接 or 同一个主机只建立一个连接
- 非持续连接造成了会给服务器带来很重的负担
- 在持续连接情况下，服务器在发送响应后仍保持连接打开，再次接收到该客户端请求后仍通过该连接发送响应。若在一段时间内某一连接一直未被使用，服务器就关闭该连接。

**在三次握手的最后一次时，主机会将请求和确认消息一并发送**



##### 3. HTTP报文格式

- 请求报文


![httpget](httpget.png)



第一行叫做请求行，包括方法、url和Http版本

后继的行叫做首部行，包括很多乱七八糟的，比如主机域名、上文提到的连接类型、用户代理，即向服务器发送请求的浏览器类型、用户想得到的文件内容、编码方式、语言、和两个不知道是什么的属性。

使用get方法时报文的实体体（entity body）是空的，使用post方法时会在首部后面跟一个实体，比如表单的输入值。书中特别提到表单不一定通过post方法提交，也可通过get，把参数和值挂在url的后面。

- http响应报文

![response](httpresponse.png)

第一行状态行：协议版本、状态码、短语

首部行：服务器名字、连接类型、内容类型、内容长度



#### cookie：用户与服务器的交互

cookie可以帮助服务器识别用户

![cookie](cookie.png)

在用户首次访问某服务器时，服务器给用户生成一个cookie，并保存在数据库中，同时将生成的cookie发给用户，由浏览器记录，下一次用户再访问该服务器时会在http报文头部附上cookie



#### Web缓存

代理服务器，浏览器向代理服务器发送请求，代理服务器再向初始服务器发请求，若代理服务器确认缓存有最新的被请求文件则直接发给浏览器；若没有，则由初始服务器发给代理服务器，代理服务器再发送响应给浏览器，同时在代理服务器上备份文件。它存在的意义是这样做会快很多。



#### 其他基于TCP的应用层协议

FTP（文件传输）

STMP（邮件）



#### DNS : 因特网的目录服务（基于UDP）

DNS是

1. 一个由DNS服务器实现的分布式数据库
2. 一个使得主机能够查询分布式数据库的应用层协议

DNS通常被其他应用层协议所使用、将用户提供的主机名解析为IP地址

工作过程:

1. 浏览器从URL中抽取出主机名，并将主机名传给DNS应用的客户端
2. 客户端向服务器发送一个包含主机名的请求
3. 客户端收到回应报文，得到该主机名对应的IP地址
4. 浏览器得到IP地址，建立TCP连接

获得映射的过程

1. 主机将包含域名的请求发送给本地DNS服务器
2. 本地服务器将该报文转发到根DNS服务器，得到负责管理该域名（比如 .edu）的TLD DNS服务器的列表
3. 本地DNS服务器选择其中之一发送查询报文，得到权威DNS 服务器的IP
4. 本地DNS服务器向权威服务器发送查询、得到最终的IP

![](dns.png)

DNS服务器具有缓存机制



#### Socket 编程

若要使用TCP通信，服务端需要建立两个Socket，一个用于握手，一个用于收发消息









